app.controller("HomeCtrl",["$scope","$resource","$http","$q","$location","$modal","$timeout",function(e,n,r,t,o,s,a){e.name=function(e){if(e.length<=17)return e;return e.substr(0,17)+" ..."};e.more="ОЩЕ";e.nothing=false;e.info="Засега няма информация за това което търсите!";e.sel=function(){e.goSearch()};e.ent=function(){e.goSearch()};e.addProduct=function(){var e=s.open({templateUrl:"/p/partials/add",controller:"AddCtrl",backdrop:"static",keyboard:false,windowClass:"modal fade in"});e.result.then(function(e){})};e.search="";var c=0;e.step=6;function u(e,r,t){var i=n("/api");return i.query({s:e,l:r,search:t})}e.products=u(c,e.step,e.search);e.prev=function(){if(c>=e.step){c=c-e.step;u(c,e.step,e.search).$promise.then(function(n){e.products=n;window.scrollTo(0,0)})}};e.next=function(){c=c+e.step;u(c,e.step,e.search).$promise.then(function(n){if(n.length===0){e.more="КРАЙ";c=c-e.step}else{for(i=0;i<n.length;i++){e.products.push(n[i])}if(i<6){e.more="КРАЙ"}}})};e.getProd=function(e){return r.post("/api/search",{search:e}).then(function(e){var n=window.innerWidth>0?window.innerWidth:screen.width;var r=n<400?30:55;var t=e.data;if(t!==undefined){for(i=0;i<t.length;i++){if(t[i].length>r){t[i]=t[i].substr(0,r)}}}return e.data})};e.checkIsNew=function(e){var n=new Date(e).getTime();var r=(new Date).getTime();if(r<n+7*864e5){return true}return false};e.goSearch=function(){window.scrollTo(0,0);e.nothing=false;e.search=e.search.trim();c=0;r.get("/api",{params:{s:c,l:e.step,search:e.search}}).success(function(n,r,t,i){if(n.length>0){return e.products=n}e.nothing=true;e.products=""}).error(function(e){console.log("Resource reading failed: "+e)});var n=window.innerWidth>0?window.innerWidth:screen.width;if(n<400){e.search=e.search.substr(0,20)}};e.getNumber=function(e){var n=0;e.forEach(function(e){if(!e.flagIsNew){n++}});return n}}]);