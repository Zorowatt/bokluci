app.controller("ProductCtrl",["$scope","productsCRUD","$upload","identity","usSpinnerService","$location",function(e,r,n,t,o,d){e.mainShow=true;e.bool=true;var a=[];e.imageExist=false;e.product={name:"",productModel:"",maker:"",origin:"",reseller:{name:"",town:"",price:"",dateBought:""}};e.proscon="";e.conscon="";e.error="Няма Снимка";e.removeImage=function(){e.imageExist=false;e.error="Няма Снимка";e.product.filedata=""};e.onFileSelect=function(r){a=r[0];if(a===undefined){return}var n=true;if(a.type.indexOf("image")==-1){e.error="Снимката може да бъде само в .JPEG или .PNG формат!";n=false}if(a.size>5e6){e.error="Снимката трябва да е по-малка от 5 МВ!";n=false}if(n){e.product.filename=a.name;e.imageExist=true;e.error="Избрана е снимка!";$("#name").focus()}};e.addProduct=function(r){if(!e.product.name){alert("Важно е да въведете наименование?");document.getElementById("name").focus();return}if(e.imageExist){if(confirm("Готови ли сте да изпратите този продукт?")){var u={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:t.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:t.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],id:99,userAdded:t.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,picture:[{filename:e.product.filename,dateAdded:new Date,userAdded:t.currentUser.username}],keyWords:["n/a"],category:["n/a"]};o.spin("spinner-1");$("#panel").css({"min-height":window.innerHeight-150});e.mainShow=false;window.scrollTo(0,0);n.upload({url:"/upload_image",file:a,data:u,progress:function(e){}}).progress(function(e){}).error(function(){alert(err)}).then(function(r,n,t,a){o.stop("spinner-1");e.mainShow=true;d.path("/")})}}else{if(confirm("Готови ли сте да изпратите този продукт?")){var u={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:t.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:t.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],picture:[{filename:"noPicture",dateAdded:new Date,userAdded:t.currentUser.username}],id:99,userAdded:t.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,keyWords:["n/a"],category:["n/a"]};o.spin("spinner-1");$("#panel").css({"min-height":window.innerHeight-150});e.mainShow=false;window.scrollTo(0,0);n.upload({url:"/upload_image",data:u,progress:function(e){}}).then(function(r,n,t,a){o.stop("spinner-1");e.mainShow=true;d.path("/")})}}}}]);