app.controller("ProductCtrl",["$scope","$http","productsCRUD","$upload","identity","usSpinnerService","$location",function(e,r,n,t,o,d,a){e.mainShow=true;var i=[];e.imageExist=false;var s={name:"",productModel:"",maker:"",origin:"",reseller:{name:"",town:"",price:"",dateBought:""}};e.product=s;e.proscon="";e.conscon="";e.error="No file is selected!";e.removeImage=function(){e.imageExist=false;e.error="No file is selected!";e.product.filedata=""};e.onFileSelect=function(r){i=r;var n=r[0];var t=true;if(n.type.indexOf("image")==-1){e.error="image extension not allowed, please choose a JPEG or PNG file.";t=false}if(n.size>5e6){e.error="File size cannot exceed 5 MB!";t=false}if(t){e.product.filename=n.name;e.imageExist=true;e.error="Selected file name is :  "+n.name}};e.addProduct=function(r){if(!e.product.name){alert("Важно е да въведете наименование?");document.getElementById("name").focus();return}if(e.imageExist){if(confirm("Готови ли сте да изпратите този продукт?")){var n={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:o.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:o.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],id:99,userAdded:o.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,picture:[{filename:e.product.filename,dateAdded:new Date,userAdded:o.currentUser.username}],keyWords:["n/a"],category:["n/a"]};d.spin("spinner-1");$("#panel").css({"min-height":window.innerHeight-150});e.mainShow=false;window.scrollTo(0,0);t.upload({url:"/upload_image",file:i[0],data:n,progress:function(e){}}).progress(function(e){}).error(function(){alert(err)}).then(function(r,n,t,o){d.stop("spinner-1");e.mainShow=true;a.path("/")})}}else{if(confirm("Готови ли сте да изпратите този продукт?")){var n={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:o.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:o.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],picture:[{filename:"noPicture",dateAdded:new Date,userAdded:o.currentUser.username}],id:99,userAdded:o.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,keyWords:["n/a"],category:["n/a"]};d.spin("spinner-1");$("#panel").css({"min-height":window.innerHeight-150});e.mainShow=false;window.scrollTo(0,0);t.upload({url:"/upload_image",data:n,progress:function(e){}}).then(function(r,n,t,o){d.stop("spinner-1");e.mainShow=true;a.path("/")})}}}}]);