app.controller("ProductCtrl",["$scope","$http","productsCRUD","$upload","identity",function(e,r,t,o,d){var n=[];e.imageExist=false;var a={name:"",productModel:"",maker:"",origin:"",reseller:{name:"",town:"",price:"",dateBought:""}};e.product=a;e.proscon="";e.conscon="";e.error="No file is selected!";e.removeImage=function(){e.imageExist=false;e.error="No file is selected!";e.product.filedata=""};e.onFileSelect=function(r){n=r;var t=r[0];var o=true;if(t.type.indexOf("image")==-1){e.error="image extension not allowed, please choose a JPEG or PNG file.";o=false}if(t.size>5e6){e.error="File size cannot exceed 5 MB!";o=false}if(o){e.product.filename=t.name;e.imageExist=true;e.error="Selected file name is :  "+t.name}};e.addProduct=function(r){if(!e.product.name){alert("Важно е да въведете наименование?");document.getElementById("name").focus();return}if(e.imageExist){if(confirm("Готовисте ли сте да изпратите този продукт?")){var t={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:d.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:d.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],id:99,userAdded:d.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,picture:[{filename:e.product.filename,dateAdded:new Date,userAdded:d.currentUser.username}],keyWords:["n/a"],category:["n/a"]};o.upload({url:"/upload_image",file:n[0],data:t,progress:function(e){}}).then(function(e,r,t,o){$("#uiLockId").remove();alert("done!")});$("<div></div>").attr("id","uiLockId").css({position:"absolute",top:0,left:0,"z-index":1e3,opacity:.8,width:"100%",height:"100%",color:"white","background-color":"orange"}).html("").appendTo("body");e.product.name="";e.product.productModel="";e.product.maker="";e.product.origin="";e.product.reseller.name="";e.product.reseller.town="";e.product.reseller.price="";e.product.reseller.dateBought="";e.proscon="";e.conscon="";e.imageExist=false;e.error="No file is selected!";e.product.filedata=""}}else{if(confirm("Готовисте ли сте да изпратите този продукт?")){var t={name:e.product.name,productModel:e.product.productModel||"--",maker:e.product.maker||"--",origin:e.product.origin||"--",reseller:{name:e.product.reseller.name||"--",town:e.product.reseller.town||"--",price:e.product.reseller.price||"--",dateBought:e.product.reseller.dateBought||"--"},pros:[{userAdded:d.currentUser.username,dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{userAdded:d.currentUser.username,dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],picture:[{filename:"noPicture",dateAdded:new Date,userAdded:d.currentUser.username}],id:99,userAdded:d.currentUser.username,dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,keyWords:["n/a"],category:["n/a"]};o.upload({url:"/upload_image",data:t,progress:function(e){}}).then(function(e,r,t,o){});e.product.name="";e.product.productModel="";e.product.maker="";e.product.origin="";e.product.reseller.name="";e.product.reseller.town="";e.product.reseller.price="";e.product.reseller.dateBought="";e.proscon="";e.conscon="";e.imageExist=false;e.error="No file is selected!";e.product.filedata=""}}}}]);