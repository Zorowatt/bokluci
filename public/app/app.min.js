var app=angular.module("app",["ngResource","ngRoute","angularFileUpload","ui.bootstrap","ngActivityIndicator"]);app.config(["$locationProvider","$routeProvider",function(e,t){e.html5Mode(true);t.when("/topic/:id",{templateUrl:"/p/partials/productShow",controller:"ProductShowCtrl"}).when("/",{templateUrl:"/home",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]);app.config(["$tooltipProvider",function(e){e.setTriggers({mouseenter:"mouseleave",click:"click",focus:"blur",never:"mouseleave",show:"hide"});e.options({placement:"top",animation:true,popupDelay:700,appendToBody:false})}]);app.config(["$activityIndicatorProvider",function(e){e.setActivityIndicatorStyle("CircledDark")}]);app.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){if(t.which===13){e.$apply(function(){e.$eval(n.ngEnter)});t.preventDefault()}})}});app.directive("customPopover",function(){return{restrict:"A",template:"<span>{{label}}</span>",link:function(e,t,n){e.label=n.popoverLabel;$(t).popover({trigger:"click",html:true,content:n.popoverHtml,placement:n.popoverPlacement})}}});app.config(["$provide",function(e){e.decorator("typeaheadDirective",["$delegate","$timeout",function(e,t){var n=e[e.length-1].compile;e[e.length-1].compile=function(){var a=n.apply(e,Array.prototype.slice.call(arguments,0));return function(e,n,o){var r=a.apply(a,Array.prototype.slice.call(arguments,0));var i=e.$$childTail;var l=i.select;i.select=function(e){if(e<0){i.matches=[];n.attr("aria-expanded",false);t(function(){n[0].focus()},0,false)}else{l.apply(i,Array.prototype.slice.call(arguments,0))}};i.$watchCollection("matches",function(){i.activeIdx=-1});return r}};return e}])}]);app.controller("ConfirmMessageCtrl",["$scope","$modalInstance","message","$timeout",function(e,t,n,a){e.message=n;e.closeMe=function(){t.close("close")};a(function(){t.close("close")},3e3)}]);app.controller("ShowMeCtrl",["$scope","$modalInstance","message",function(e,t,n){e.message=n;e.closeMe=function(){t.dismiss("close")}}]);app.controller("AddCtrl",["$scope","$modalInstance","$modal","$upload","$timeout","$activityIndicator",function(e,t,n,a,o,r){e.uploadSpin=false;e.imageSpin=false;e.fileId="na";e.thumbId="na";e.adding=false;e.imageExistGet=true;e.alert=[];e.imageMessage="Няма Снимка";function i(t,n){e.alert[t]=n;o(function(){e.alert[t]=""},3e3)}e.$watch("product.name",function(t,n){if(t!==undefined&&t.length>50){e.product.name=n;return i(0,"Моля темата да не е по-дълга от 50 символа!")}});e.ent=function(){};e.titles=true;if(!document.__proto__){e.titles=true}e.imageExist=false;e.product={};var l=undefined;e.removeImage=function(){e.imageExistGet=true;e.imageExist=false;e.product.filedata="";l=undefined;window.scrollTo(0,0);e.imageMessage="Няма Снимка"};e.closeMe=function(){if(!e.adding){return t.dismiss("close")}var a=n.open({templateUrl:"/p/partials/confirmMessage",controller:"ConfirmMessageCtrl",size:"sm",resolve:{message:function(){return"Моля изчакайте снимката да се зареди!"}}})};e.addImage=function(t){e.fileId="na";e.thumbId="na";e.imageExistGet=false;e.proppername="";l=t[0];if(l===undefined){return}if(l.type.indexOf("image")==-1){return i(1,"Снимката трябва да бъде в подходящ формат - .JPEG,.PNG ...!")}if(l.size>5e6){return i(1,"Снимката трябва да е по-малка от 5 МВ!")}e.adding=true;e.imageMessage="Снимката се зарежда...";e.imageSpin=true;r.startAnimating();a.upload({url:"/convert",file:l}).progress(function(t){var n=t.total;var a=t.loaded;var o=Math.round(a/n*100);e.imageMessage=o+"%"}).error(function(t){e.imageExist=false;alert(t)}).then(function(t,n,a,o){e.imageSpin=false;r.stopAnimating();e.imageExist=true;if(t.data==""){e.imageExistGet=true;e.adding=false;e.imageSpin=false;e.imageExist=false;return i(1,"Тази снимка не се разпознава!  Моля добавете друга снимка.")}e.adding=false;var l=t.data.substr(-40);e.fileId=l.slice(20);e.thumbId=l.substr(0,20);e.img=t.data.slice(0,-40)})};e.upload=function(){if(!e.product.name){i(0,"Важно е да въведете тема, наименование, описание ...");document.getElementById("name").focus();return}if(!e.proscon&&!e.conscon){document.getElementById("mnenie").focus();i(2,"Моля напишете мнението си и/или препоръка?");return}var o={name:e.product.name,pros:[{dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,thumbnail:e.thumbId};a.upload({url:"/upload_image",data:o}).progress(function(){}).error(function(){alert(err)}).then(function(e,a,o,r){t.dismiss();var i=n.open({templateUrl:"/p/partials/confirmMessage",controller:"ConfirmMessageCtrl",size:"sm",resolve:{message:function(){return"Вашата тема бе добавена успешно!"}}})})}}]);app.controller("CommentsCtrl",["$scope","$modalInstance","message",function(e,t,n){e.message=n;e.comment="";e.closeMe=function(){t.dismiss("close")};e.add=function(){t.close(e.comment)}}]);