var app=angular.module("app",["ngResource","ngRoute","angularFileUpload","ui.bootstrap","ngActivityIndicator"]);app.config(["$locationProvider","$routeProvider",function(e,t){e.html5Mode(true);t.when("/topic/:id",{templateUrl:"/p/partials/productShow",controller:"ProductShowCtrl"}).when("/",{templateUrl:"/home",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]);app.config(["$tooltipProvider",function(e){e.setTriggers({mouseenter:"mouseleave",click:"click",focus:"blur",never:"mouseleave",show:"hide"});e.options({placement:"top",animation:true,popupDelay:700,appendToBody:false})}]);app.config(["$activityIndicatorProvider",function(e){e.setActivityIndicatorStyle("CircledDark")}]);app.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){if(t.which===13){e.$apply(function(){e.$eval(n.ngEnter)});t.preventDefault()}})}});app.directive("customPopover",function(){return{restrict:"A",template:"<span>{{label}}</span>",link:function(e,t,n){e.label=n.popoverLabel;$(t).popover({trigger:"click",html:true,content:n.popoverHtml,placement:n.popoverPlacement})}}});app.config(["$provide",function(e){e.decorator("typeaheadDirective",["$delegate","$timeout",function(e,t){var n=e[e.length-1].compile;e[e.length-1].compile=function(){var o=n.apply(e,Array.prototype.slice.call(arguments,0));return function(e,n,r){var a=o.apply(o,Array.prototype.slice.call(arguments,0));var i=e.$$childTail;var l=i.select;i.select=function(e){if(e<0){i.matches=[];n.attr("aria-expanded",false);t(function(){n[0].focus()},0,false)}else{l.apply(i,Array.prototype.slice.call(arguments,0))}};i.$watchCollection("matches",function(){i.activeIdx=-1});return a}};return e}])}]);app.controller("ConfirmMessageCtrl",["$scope","$modalInstance","message","$timeout",function(e,t,n,o){e.message=n;e.closeMe=function(){t.close("close")};o(function(){t.close("close")},3e3)}]);app.controller("ShowMeCtrl",["$scope","$modalInstance","message",function(e,t,n){e.message=n;e.closeMe=function(){t.dismiss("close")}}]);app.controller("AddCtrl",["$scope","$modalInstance","$modal","$upload","$timeout","$activityIndicator",function(e,t,n,o,r,a){e.uploadSpin=false;e.imageSpin=false;e.fileId="na";e.thumbId="na";e.adding=false;e.imageExistGet=true;e.alert=[];e.imageMessage="Няма Снимка";function i(t,n){e.alert[t]=n;r(function(){e.alert[t]=""},3e3)}e.$watch("product.name",function(t,n){if(t!==undefined&&t.length>100){e.product.name=n;return i(0,"Моля темата да не е по-дълга от 100 символа!")}});e.ent=function(){};e.titles=true;if(!document.__proto__){e.titles=true}e.imageExist=false;e.product={};var l=undefined;e.removeImage=function(){e.imageExistGet=true;e.imageExist=false;e.product.filedata="";l=undefined;window.scrollTo(0,0);e.imageMessage="Няма Снимка"};e.closeMe=function(){if(!e.adding){return t.dismiss("close")}var o=n.open({templateUrl:"/p/partials/confirmMessage",controller:"ConfirmMessageCtrl",size:"sm",resolve:{message:function(){return"Моля изчакайте снимката да се зареди!"}}})};e.addImage=function(t){e.fileId="na";e.thumbId="na";e.imageExistGet=false;e.proppername="";l=t[0];if(l===undefined){return}if(l.type.indexOf("image")==-1){return i(1,"Снимката трябва да бъде в подходящ формат - .JPEG,.PNG ...!")}if(l.size>5e6){return i(1,"Снимката трябва да е по-малка от 5 МВ!")}e.adding=true;e.imageMessage="Снимката се зарежда...";e.imageSpin=true;a.startAnimating();o.upload({url:"/convert",file:l}).progress(function(t){var n=t.total;var o=t.loaded;var r=Math.round(o/n*100);e.imageMessage=r+"%"}).error(function(t){e.imageExist=false;alert(t)}).then(function(t,n,o,r){e.imageSpin=false;a.stopAnimating();e.imageExist=true;if(t.data==""){e.imageExistGet=true;e.adding=false;e.imageSpin=false;e.imageExist=false;return i(1,"Тази снимка не се разпознава!  Моля добавете друга снимка.")}e.adding=false;var l=t.data.substr(-40);e.fileId=l.slice(20);e.thumbId=l.substr(0,20);e.img=t.data.slice(0,-40)})};e.upload=function(){if(!e.product.name){i(0,"Важно е да въведете тема, наименование, описание ...");document.getElementById("topic").focus();return}if(!e.proscon&&!e.conscon){document.getElementById("mnenie").focus();i(2,"Моля напишете мнението си и/или препоръка?");return}var r={name:e.product.name,pros:[{dateAdded:new Date,content:e.proscon||"--",flagIsNew:true}],cons:[{dateAdded:new Date,content:e.conscon||"--",flagIsNew:true}],dateAdded:new Date,flagIsNew:true,flagNewCommentAdded:true,thumbnail:e.thumbId};o.upload({url:"/upload_image",data:r}).progress(function(){}).error(function(){alert(err)}).then(function(e,o,r,a){t.dismiss();var i=n.open({templateUrl:"/p/partials/confirmMessage",controller:"ConfirmMessageCtrl",size:"sm",resolve:{message:function(){return"Вашата тема бе добавена успешно!"}}})})}}]);app.controller("CommentsCtrl",["$scope","$modalInstance","message",function(e,t,n){e.message=n;e.comment="";e.closeMe=function(){t.dismiss("close")};e.add=function(){t.close(e.comment)}}]);app.constant("msdElasticConfig",{append:""});app.directive("msdElastic",["$timeout","$window","msdElasticConfig",function(e,t,n){"use strict";return{require:"ngModel",restrict:"A, C",link:function(o,r,a,i){var l=r[0],s=r;if(l.nodeName!=="TEXTAREA"||!t.getComputedStyle){return}s.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var c=l.value;l.value="";l.value=c;var u=a.msdElastic?a.msdElastic.replace(/\\n/g,"\n"):n.append,p=angular.element(t),d="position: absolute; top: -999px; right: auto; bottom: auto;"+"left: 0; overflow: hidden; -webkit-box-sizing: content-box;"+"-moz-box-sizing: content-box; box-sizing: content-box;"+"min-height: 0 !important; height: 0 !important; padding: 0;"+"word-wrap: break-word; border: 0;",g=angular.element('<textarea tabindex="-1" '+'style="'+d+'"/>').data("elastic",true),f=g[0],m=getComputedStyle(l),h=m.getPropertyValue("resize"),y=m.getPropertyValue("box-sizing")==="border-box"||m.getPropertyValue("-moz-box-sizing")==="border-box"||m.getPropertyValue("-webkit-box-sizing")==="border-box",v=!y?{width:0,height:0}:{width:parseInt(m.getPropertyValue("border-right-width"),10)+parseInt(m.getPropertyValue("padding-right"),10)+parseInt(m.getPropertyValue("padding-left"),10)+parseInt(m.getPropertyValue("border-left-width"),10),height:parseInt(m.getPropertyValue("border-top-width"),10)+parseInt(m.getPropertyValue("padding-top"),10)+parseInt(m.getPropertyValue("padding-bottom"),10)+parseInt(m.getPropertyValue("border-bottom-width"),10)},b=parseInt(m.getPropertyValue("min-height"),10),w=parseInt(m.getPropertyValue("height"),10),I=Math.max(b,w)-v.height,$=parseInt(m.getPropertyValue("max-height"),10),x,P,C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if(s.data("elastic")){return}$=$&&$>0?$:9e4;if(f.parentNode!==document.body){angular.element(document.body).append(f)}s.css({resize:h==="none"||h==="vertical"?"none":"horizontal"}).data("elastic",true);function E(){var e=d;x=l;m=getComputedStyle(l);angular.forEach(C,function(t){e+=t+":"+m.getPropertyValue(t)+";"});f.setAttribute("style",e)}function z(){var t,n,r,a,i;if(x!==l){E()}if(!P){P=true;f.value=l.value+u;f.style.overflowY=l.style.overflowY;t=l.style.height===""?"auto":parseInt(l.style.height,10);n=getComputedStyle(l).getPropertyValue("width");if(n.substr(n.length-2,2)==="px"){a=parseInt(n,10)-v.width;f.style.width=a+"px"}r=f.scrollHeight;if(r>$){r=$;i="scroll"}else if(r<I){r=I}r+=v.height;l.style.overflowY=i||"hidden";if(t!==r){l.style.height=r+"px";o.$emit("elastic:resize",s)}e(function(){P=false},1)}}function M(){P=false;z()}if("onpropertychange"in l&&"oninput"in l){l["oninput"]=l.onkeyup=z}else{l["oninput"]=z}p.bind("resize",M);o.$watch(function(){return i.$modelValue},function(e){M()});o.$on("elastic:adjust",function(){E();M()});e(z);o.$on("$destroy",function(){g.remove();p.unbind("resize",M)})}}}]);